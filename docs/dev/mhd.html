

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>MHD &mdash; Castro  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"TeX": {"Macros": {"kth": "{{k_\\mathrm{th}}}", "gcc": "{\\mathrm{g~cm^{-3}}}", "cms": "{\\mathrm{cm~s^{-1}}}", "presunit": "{\\mathrm{dyn~cm^{-2}}}", "accelunit": "{\\mathrm{cm~s^{-2}}}", "ergg": "{\\mathrm{erg~g^{-1}}}", "Ab": "{{\\bf A}}", "eb": "{{\\bf e}}", "Fb": "{{\\bf F}}", "gb": "{{\\bf g}}", "Hb": "{{\\bf H}}", "ib": "{{\\bf i}}", "Ib": "{{\\bf I}}", "Kb": "{{\\bf K}}", "lb": "{{\\bf l}}", "Lb": "{{\\bf L}}", "nb": "{{\\bf n}}", "Pb": "{{\\bf P}}", "Qb": "{{\\bf Q}}", "rb": "{{\\bf r}}", "Rb": "{{\\bf R}}", "Sb": "{{\\bf S}}", "ub": "{{\\bf u}}", "Ub": "{{\\bf U}}", "xb": "{{\\bf x}}", "dt": "{\\Delta t}", "omegadot": "{\\dot\\omega}", "inp": "{{\\rm in}}", "outp": "{{\\rm out}}", "sync": "{{\\rm sync}}", "half": "{\\frac{1}{2}}", "myhalf": "{\\half}", "nph": "{{n+\\myhalf}}", "kpp": "{\\ensuremath{\\kappa_{\\mathrm{P}}}}", "kpr": "{\\ensuremath{\\kappa_{\\mathrm{R}}}}", "kpf": "{\\ensuremath{\\kappa_{\\mathrm{F}}}}", "vb": "{\\boldsymbol{v}}", "vbt": "{\\widetilde{\\vb}}", "rbt": "{\\widetilde{\\rb}}", "ob": "{\\boldsymbol{\\omega}}", "nablab": "{\\boldsymbol{\\nabla}}", "avg": ["{{\\left \\langle #1 \\right \\rangle}}", 1]}}})</script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Gravity" href="gravity.html" />
    <link rel="prev" title="Hydrodynamics" href="Hydrodynamics.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          


          
            <a href="index.html" class="icon icon-home"> Castro
          

          
            
            <img src="_static/castro_logo_hot_200.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
    <div class="branch">
        Branch: <a href="../mhd.html">main</a> | <a href="./mhd.html">development</a>
    </div>

        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Castro basics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Preface.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="Introduction.html">Introduction to Castro</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="inputs.html">Input Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="rp_intro.html">Runtime Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="mpi_plus_x.html">Running Options: CPUs and GPUs</a></li>
<li class="toctree-l1"><a class="reference internal" href="FlowChart.html">Flowchart</a></li>
<li class="toctree-l1"><a class="reference internal" href="software.html">Software Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="problem_setups.html">Distributed Problem Setups</a></li>
<li class="toctree-l1"><a class="reference internal" href="timestepping.html">Timestepping and Retries</a></li>
<li class="toctree-l1"><a class="reference internal" href="creating_a_problem.html">Setting Up Your Own Problem</a></li>
<li class="toctree-l1"><a class="reference internal" href="io.html">Outputting</a></li>
<li class="toctree-l1"><a class="reference internal" href="regridding.html">Regridding</a></li>
<li class="toctree-l1"><a class="reference internal" href="visualization.html">Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption"><span class="caption-text">Castro reference</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="build_system.html">Build System Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="gpu_porting.html">Offloading a routine to GPU</a></li>
<li class="toctree-l1"><a class="reference internal" href="Hydrodynamics.html">Hydrodynamics</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">MHD</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#equations-and-data-structures">Equations and Data Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="#problem-initialization">Problem Initialization</a></li>
<li class="toctree-l2"><a class="reference internal" href="#hydrodynamics-update">Hydrodynamics Update</a></li>
<li class="toctree-l2"><a class="reference internal" href="#electric-update">Electric Update</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="gravity.html">Gravity</a></li>
<li class="toctree-l1"><a class="reference internal" href="diffusion.html">Diffusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="rotation.html">Rotation</a></li>
<li class="toctree-l1"><a class="reference internal" href="sponge.html">Sponge</a></li>
<li class="toctree-l1"><a class="reference internal" href="radiation.html">Radiation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Particles.html">Tracer particles</a></li>
<li class="toctree-l1"><a class="reference internal" href="EOSNetwork.html">Microphysics</a></li>
<li class="toctree-l1"><a class="reference internal" href="sdc.html">Spectral Deferred Corrections</a></li>
<li class="toctree-l1"><a class="reference internal" href="AMR.html">Adaptive Mesh Refinement</a></li>
<li class="toctree-l1"><a class="reference internal" href="ConvertCheckpoint.html">Checkpoint Embiggener</a></li>
<li class="toctree-l1"><a class="reference internal" href="self_consistent_field.html">Self-Consistent Field Initialization</a></li>
<li class="toctree-l1"><a class="reference internal" href="MAESTRO_restart.html">Restarting from Maestro</a></li>
<li class="toctree-l1"><a class="reference internal" href="Verification.html">Verification</a></li>
<li class="toctree-l1"><a class="reference internal" href="development.html">Development Best Practices</a></li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="filelist.html">File list</a></li>
<li class="toctree-l1"><a class="reference internal" href="classlist.html">Class list</a></li>
</ul>
<p class="caption"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="zreferences.html">References</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Castro</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>MHD</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/mhd.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="mhd">
<span id="ch-mhd"></span><h1>MHD<a class="headerlink" href="#mhd" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Castro implements a constrained transport (CT) corner transport upwind
(CTU) ideal MHD scheme based on the work of Miniati &amp; Martin
<span id="id1">[<a class="reference internal" href="zreferences.html#id50">5</a>]</span>.  MHD is enabled by compiling with <code class="docutils literal notranslate"><span class="pre">USE_MHD</span> <span class="pre">=</span>
<span class="pre">TRUE</span></code>.  This replaces the pure hydrodynamics solver, but uses the
same driver as the CTU hydrodynamics solver.  This means that all of
the source terms supported by the hydrodynamics solver are also
supported by MHD.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The MHD solver supports 3-d only.</p>
<p>Currently the MHD solver is single-level only.  AMR support is forthcoming.</p>
</div>
</div>
<div class="section" id="equations-and-data-structures">
<h2>Equations and Data Structures<a class="headerlink" href="#equations-and-data-structures" title="Permalink to this headline">¶</a></h2>
<p>The ideal MHD equations we solve appear as:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align}
\frac{\partial \rho X_k}{\partial t} + \frac{\partial}{\partial x_j} ( \rho U_j X_k) &amp;= \rho \omegadot_k \\
\frac{\partial \rho U_j}{\partial t} + \frac{\partial}{\partial x_j} (\rho U_i U_j + p \delta_{ij} - B_j B_i) &amp;= S_{\rho U_j} \\
\frac{\partial \rho E}{\partial t} + \frac{\partial}{\partial x_j} \left [ U_j (\rho E + p) - B_j B_i u_i \right ] &amp;= S_{\rho E} + \rho H_\mathrm{nuc} \\
\frac{\partial B_i}{\partial t} &amp;= -\frac{\partial}{\partial x_j} (U_j B_i - B_j U_i)
\end{align}\end{split}\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[p = p_g + \frac{1}{2} B^2\]</div>
<p>and the <span class="math notranslate nohighlight">\(S\)</span> sources represent the hydrodynamical sources and
the remainder are reaction sources.  The MHD solver uses the same
time-advancement driver as the hydrodynamic CTU driver
(<a class="reference internal" href="FlowChart.html#sec-strangctu"><span class="std std-ref">Strang+CTU Evolution</span></a>), using Strang splitting for the reactions (by
default).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note: we are following the convention in the MHD community of setting the permeability to unity.  This is
why the magnetic pressure has the form <span class="math notranslate nohighlight">\(\frac{1}{2} B^2\)</span> instead of <span class="math notranslate nohighlight">\(\frac{1}{8\pi} B^2\)</span>.  In
effect, we are carrying our magnetic field as <span class="math notranslate nohighlight">\({\bf B}^\prime = {\bf B}/\sqrt{4\pi}\)</span>.</p>
<p>If you wish to express the magnetic field in Gauss, then you will need to multiply the value Castro carries
by <span class="math notranslate nohighlight">\(\sqrt{4\pi}\)</span>.</p>
</div>
<p>The constrained transport algorithm algebraically ensures that
<span class="math notranslate nohighlight">\(\nabla \cdot {\bf B} = 0\)</span>.  Throughout the algorithm, the
magnetic fields are face-centered, the electric fields are
edge-centered, and the conserved state is cell-centered (or averages),
unless specified otherwise.  We use the following indexing
conventions:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">U(i,j,k)</span></code> is the cell-centered state, <span class="math notranslate nohighlight">\(U_{i,j,k}\)</span></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">qleft(i,j,k)</span></code> is the interface value of a state, for example,
in the x-direction this would be <span class="math notranslate nohighlight">\(q_{i-1/2,j,k}\)</span></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Bx(i,j,k)</span></code> is the face-centered x-component of the magnetic field,
<span class="math notranslate nohighlight">\(B_{x,i-1/2,j,k}\)</span></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Ex(i,j,k)</span></code> is the edge-centered x-component of the electric field,
<span class="math notranslate nohighlight">\(E_{x,i,j-1/2,k-1/2}\)</span></p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="problem-initialization">
<h2>Problem Initialization<a class="headerlink" href="#problem-initialization" title="Permalink to this headline">¶</a></h2>
<p id="index-0">There is an additional initialization routine for MHD, <code class="docutils literal notranslate"><span class="pre">ca_initmag</span></code>
that is used to initialize the face-centered magnetic field
components.  This is done separately from the main conserved fluid
state.</p>
<p>The conserved fluid state is initialized in <code class="docutils literal notranslate"><span class="pre">ca_initdata</span></code> just as
with pure hydrodynamics problems. Note that you do not need to include
the magnetic energy contribution to the total energy density, <code class="docutils literal notranslate"><span class="pre">UEDEN</span></code>.
After this initialization, the driver handles the addition of the magnetic
contribution.</p>
</div>
<div class="section" id="hydrodynamics-update">
<h2>Hydrodynamics Update<a class="headerlink" href="#hydrodynamics-update" title="Permalink to this headline">¶</a></h2>
<p>We use piecewise linear or piecewise parabolic reconstruction with a
characteristic projection and the full 12-Riemann solve corner
transport upwind method.  The HLLD Riemann solver is used.</p>
<p>Within the solver, we use the same indexing into the primitive state
as defined in <a class="reference internal" href="Hydrodynamics.html#table-primlist"><span class="std std-ref">Primitive State Vector Integer Keys</span></a>, with the additions of <code class="docutils literal notranslate"><span class="pre">QMAGX</span></code>,
<code class="docutils literal notranslate"><span class="pre">QMAGY</span></code>, and <code class="docutils literal notranslate"><span class="pre">QMAGZ</span></code> for the cell-centered magnetic field
components and <code class="docutils literal notranslate"><span class="pre">QPTOT</span></code> for the total pressure (gas + magnetic).</p>
<p>Just like with pure hydrodynamics, the reconstruction type is
controlled by <code class="docutils literal notranslate"><span class="pre">castro.ppm_type</span></code>, with <code class="docutils literal notranslate"><span class="pre">0</span></code> selecting piecewise
linear and <code class="docutils literal notranslate"><span class="pre">1</span></code> selecting piecewise parabolic.</p>
<p>For the piecewise linear method, the slope limiting is controlled by
the same <code class="docutils literal notranslate"><span class="pre">plm_iorder</span></code> runtime parameter as for hydrodynamics.
Additionally, we have an option <code class="docutils literal notranslate"><span class="pre">mhd_limit_characteristic</span></code> that
controls whether you want to do the slope limiting on the
characteristic variables (the default) or the primitive variables.</p>
</div>
<div class="section" id="electric-update">
<h2>Electric Update<a class="headerlink" href="#electric-update" title="Permalink to this headline">¶</a></h2>
<p>Coupled to the hydrodynamics update is the electric field update.
Here we update the components of E using the contact upwind scheme
first proposed in <span id="id2">[<a class="reference internal" href="zreferences.html#id51">33</a>]</span>.  The updated electric field then
gives the magnetic field via Faraday’s law and the discretization ensures
that <span class="math notranslate nohighlight">\(\nabla \cdot {\bf B} = 0\)</span>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="gravity.html" class="btn btn-neutral float-right" title="Gravity" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="Hydrodynamics.html" class="btn btn-neutral float-left" title="Hydrodynamics" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2018-2020, Castro development tem.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    


</body>
</html>