

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Radiation &mdash; Castro  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=9edc463e" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="_static/sphinx_rtd_theme_ext_color_contrast.css?v=8e8ea19f" />
      <link rel="stylesheet" type="text/css" href="_static/theme_overrides.css?v=e375baa2" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=5929fcd5"></script>
      <script src="_static/doctools.js?v=fd6eb6e6"></script>
      <script src="_static/sphinx_highlight.js?v=6ffebe34"></script>
      <script src="_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="_static/copybutton.js?v=eaa7b67c"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "macros": {"kth": "{{k_\\mathrm{th}}}", "gcc": "{\\mathrm{g~cm^{-3}}}", "cms": "{\\mathrm{cm~s^{-1}}}", "presunit": "{\\mathrm{dyn~cm^{-2}}}", "accelunit": "{\\mathrm{cm~s^{-2}}}", "ergg": "{\\mathrm{erg~g^{-1}}}", "Ab": "{{\\bf A}}", "eb": "{{\\bf e}}", "Fb": "{{\\bf F}}", "gb": "{{\\bf g}}", "Hb": "{{\\bf H}}", "ib": "{{\\bf i}}", "Ib": "{{\\bf I}}", "Kb": "{{\\bf K}}", "lb": "{{\\bf l}}", "Lb": "{{\\bf L}}", "nb": "{{\\bf n}}", "Pb": "{{\\bf P}}", "Qb": "{{\\bf Q}}", "rb": "{{\\bf r}}", "Rb": "{{\\bf R}}", "Sb": "{{\\bf S}}", "ub": "{{\\bf u}}", "Ub": "{{\\bf U}}", "xb": "{{\\bf x}}", "dt": "{\\Delta t}", "omegadot": "{\\dot\\omega}", "inp": "{{\\rm in}}", "outp": "{{\\rm out}}", "sync": "{{\\rm sync}}", "half": "{\\frac{1}{2}}", "myhalf": "{\\half}", "nph": "{{n+\\myhalf}}", "kpp": "{\\ensuremath{\\kappa_{\\mathrm{P}}}}", "kpr": "{\\ensuremath{\\kappa_{\\mathrm{R}}}}", "kpf": "{\\ensuremath{\\kappa_{\\mathrm{F}}}}", "vb": "{\\boldsymbol{v}}", "vbt": "{\\widetilde{\\vb}}", "rbt": "{\\widetilde{\\rb}}", "ob": "{\\boldsymbol{\\omega}}", "nablab": "{\\boldsymbol{\\nabla}}", "avg": ["{{\\left \\langle #1 \\right \\rangle}}", 1]}}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@4/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Tracer particles" href="Particles.html" />
    <link rel="prev" title="Sponge" href="sponge.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >


          
          
          <a href="index.html" class="icon icon-home">
            Castro
              <img src="_static/castro_logo_hot_200.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
    <div class="branch">
        Branch: <a href="../radiation.html">main</a> | <a href="./radiation.html">development</a>
    </div>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Castro basics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Preface.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="Introduction.html">Introduction to Castro</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="inputs.html">Input Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="rp_intro.html">Runtime Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="mpi_plus_x.html">Running Options: CPUs and GPUs</a></li>
<li class="toctree-l1"><a class="reference internal" href="FlowChart.html">Flowchart</a></li>
<li class="toctree-l1"><a class="reference internal" href="software.html">Software Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="gpu.html">GPU Programming Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="problem_setups.html">Distributed Problem Setups</a></li>
<li class="toctree-l1"><a class="reference internal" href="timestepping.html">Timestepping and Retries</a></li>
<li class="toctree-l1"><a class="reference internal" href="creating_a_problem.html">Setting Up Your Own Problem</a></li>
<li class="toctree-l1"><a class="reference internal" href="io.html">Outputting</a></li>
<li class="toctree-l1"><a class="reference internal" href="regridding.html">Regridding</a></li>
<li class="toctree-l1"><a class="reference internal" href="visualization.html">Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="performance.html">Performance Tips</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Castro reference</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="build_system.html">Build System Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="Hydrodynamics.html">Hydrodynamics</a></li>
<li class="toctree-l1"><a class="reference internal" href="hse.html">Hydrostatic Equilibrium</a></li>
<li class="toctree-l1"><a class="reference internal" href="EOS.html">Equation of State</a></li>
<li class="toctree-l1"><a class="reference internal" href="reactions.html">Reactions</a></li>
<li class="toctree-l1"><a class="reference internal" href="mhd.html">MHD</a></li>
<li class="toctree-l1"><a class="reference internal" href="gravity.html">Gravity</a></li>
<li class="toctree-l1"><a class="reference internal" href="diffusion.html">Thermal Diffusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="rotation.html">Rotation</a></li>
<li class="toctree-l1"><a class="reference internal" href="sponge.html">Sponge</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Radiation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#getting-started">Getting Started</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#getting-the-code">Getting the Code</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#microphysics-eos-network-and-opacity">Microphysics: EOS, Network, and Opacity</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#eos">EOS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#network">Network</a></li>
<li class="toctree-l3"><a class="reference internal" href="#opacity">Opacity</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#opacity-parameters">Opacity Parameters</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#radiation-solver-physics">Radiation Solver Physics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#verbosity-and-i-o">Verbosity and I/O</a></li>
<li class="toctree-l3"><a class="reference internal" href="#flux-limiter-and-closure">Flux Limiter and Closure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#boundary-conditions">Boundary Conditions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#convergence">Convergence</a></li>
<li class="toctree-l3"><a class="reference internal" href="#parameters-for-gray-solver">Parameters for Gray Solver</a></li>
<li class="toctree-l3"><a class="reference internal" href="#grouping-in-the-mg-solver">Grouping in the MG Solver</a></li>
<li class="toctree-l3"><a class="reference internal" href="#parameters-for-mg-solver">Parameters for MG Solver</a></li>
<li class="toctree-l3"><a class="reference internal" href="#linear-system-solver">Linear System Solver</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#output">Output</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#gray-solver">Gray Solver</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Particles.html">Tracer particles</a></li>
<li class="toctree-l1"><a class="reference internal" href="sdc.html">Spectral Deferred Corrections</a></li>
<li class="toctree-l1"><a class="reference internal" href="AMR.html">Adaptive Mesh Refinement</a></li>
<li class="toctree-l1"><a class="reference internal" href="ConvertCheckpoint.html">Checkpoint Embiggener</a></li>
<li class="toctree-l1"><a class="reference internal" href="self_consistent_field.html">Self-Consistent Field Initialization</a></li>
<li class="toctree-l1"><a class="reference internal" href="MAESTRO_restart.html">Restarting from Maestro</a></li>
<li class="toctree-l1"><a class="reference internal" href="Verification.html">Verification</a></li>
<li class="toctree-l1"><a class="reference internal" href="development.html">Development Best Practices</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="filelist.html">File list</a></li>
<li class="toctree-l1"><a class="reference internal" href="classlist.html">Class list</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="zreferences.html">References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Castro</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Radiation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/radiation.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="radiation">
<span id="ch-radiation"></span><h1>Radiation<a class="headerlink" href="#radiation" title="Link to this heading"></a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading"></a></h2>
<p>Castro has three radiation solvers:</p>
<ul class="simple">
<li><p>SingleGroupSolver: this solver does not have radiation
pressure. It is pure hydro plus radiation diffusion. This is only
applicable when the medium is optically thick and the pressure is small.</p></li>
<li><p>SGFLDSolver: this is the gray flux-limited diffusion
radiation hydrodymamics solver. Here the radiation pressure is
separate from the gas pressure, and both pressures participate in
the Riemann solver.</p></li>
<li><p>MGFLDSolver: this is the multigroup flux-limited diffusion
radiation hydrodynamics solver. As with the gray solver, radiation
pressure contributes to the pressure in the Riemann solver. Here a
number of energy groups are used to represent the radiation field,
and the opacity can be frequency-dependent.</p></li>
</ul>
<p>The gray solver has a comoving frame mode and a mixed frame mode,
whereas the MG solver uses the comoving frame approach. More details
about the formulation and algorithm can be found in the series of
Castro papers.</p>
</section>
<section id="getting-started">
<h2>Getting Started<a class="headerlink" href="#getting-started" title="Link to this heading"></a></h2>
<section id="getting-the-code">
<h3>Getting the Code<a class="headerlink" href="#getting-the-code" title="Link to this heading"></a></h3>
<p>The Castro radiation solver is part of the main Castro git repo,
so you already have all the Castro code and problem setups
to exercise radiation. The only other requirement is a copy
of the Hypre library. Hypre provides the algebraic multigrid
solvers used by the implicit radiation update. You can get
a copy at <a class="reference external" href="https://github.com/hypre-space/hypre">https://github.com/hypre-space/hypre</a> (the minimum
supported release version is 2.23.0). Their install
instructions describe what to do; we recommend using the autotools
and GNU Make build. On HPC clusters, you typically want to build
with the same compiler you’re using to build Castro, and you also
want to make sure that the options you’re using for Castro are
compatible with the Hypre options, in particular when it comes to
<code class="docutils literal notranslate"><span class="pre">USE_MPI</span></code>, <code class="docutils literal notranslate"><span class="pre">USE_OMP</span></code>, and <code class="docutils literal notranslate"><span class="pre">USE_CUDA</span></code>.</p>
<p>As an example, to build Hypre on Summit with MPI and CUDA, you
should load the <code class="docutils literal notranslate"><span class="pre">gcc/7.4.0</span></code> and <code class="docutils literal notranslate"><span class="pre">spectrum-mpi</span></code> modules and
then do the following from the Hypre <code class="docutils literal notranslate"><span class="pre">src/</span></code> directory,
replacing <code class="docutils literal notranslate"><span class="pre">/path/to/Hypre/install</span></code> with the target location
where you want the Hypre files to be installed.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>CUDA_HOME=$OLCF_CUDA_ROOT HYPRE_CUDA_SM=70 CXX=mpicxx CC=mpicc FC=mpifort ./configure --prefix=/path/to/Hypre/install --with-MPI --with-cuda --enable-unified-memory
make install
</pre></div>
</div>
<p>Then, when you are building Castro, you would build with
<code class="docutils literal notranslate"><span class="pre">USE_MPI=TRUE</span></code> and <code class="docutils literal notranslate"><span class="pre">USE_CUDA=TRUE</span></code>.</p>
<p>Castro looks for Hypre in the environment variable <code class="docutils literal notranslate"><span class="pre">HYPRE_DIR</span></code>,
which you should point to the install directory you chose above.
Other than that, the only difference for builds with radiation
is that you must set <code class="docutils literal notranslate"><span class="pre">USE_RAD=TRUE</span></code>.</p>
</section>
</section>
<section id="microphysics-eos-network-and-opacity">
<h2>Microphysics: EOS, Network, and Opacity<a class="headerlink" href="#microphysics-eos-network-and-opacity" title="Link to this heading"></a></h2>
<section id="eos">
<h3>EOS<a class="headerlink" href="#eos" title="Link to this heading"></a></h3>
<p>Castro provides several types of equation of state (EOS), including
gamma-law and Helmholtz. To use the gamma-law EOS, set</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">EOS_DIR</span> <span class="o">:=</span> <span class="n">gamma_law</span>
</pre></div>
</div>
<p>in the GNUmakefile.</p>
<p>The original Helmholtz EOS for stellar interiors includes a radiation
contribution. However, for radiation hydrodynamics calculations, the
radition contribution should be taken out of EOS because radiation has
been treated in other places. To use Helmholtz EOS, we will use the
version in Microphysics, as with the pure hydrodynamics code, but
this will interpret the RADIATION preprocessor variable and
disable the radiation portion of the EOS. If you have your own EOS, you
can put it in Microphysics.</p>
<p>There is also an artificial EOS that is used for several test cases called</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">EOS_DIR</span> <span class="o">:=</span> <span class="n">rad_power_law</span>
</pre></div>
</div>
<p>This EOS should only be used for pure radiation-diffusion tests (i.e.
<code class="docutils literal notranslate"><span class="pre">castro.do_hydro</span> <span class="pre">=</span> <span class="pre">0</span></code>). It defines the specific heat as a power law,</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[c_v = \mathrm{const}\ \rho^m T^{-n}\]</div>
</div></blockquote>
</section>
<section id="network">
<h3>Network<a class="headerlink" href="#network" title="Link to this heading"></a></h3>
<p>The radiation solver uses the same networks as we saw for pure hydro,
so nothing needs to change here. Again, if you are not modeling
reactions, then the general_null network can be used to define
the appropriate composition for your problem.</p>
</section>
<section id="opacity">
<h3>Opacity<a class="headerlink" href="#opacity" title="Link to this heading"></a></h3>
<p>The most commonly used opacity setup is</p>
<div class="math notranslate nohighlight" id="equation-eq-kappa">
<span class="eqno">(25)<a class="headerlink" href="#equation-eq-kappa" title="Link to this equation"></a></span>\[\kappa_\nu = \mathrm{const}\ \rho^{m} T^{-n} \nu^{p} ,\]</div>
<p>where <span class="math notranslate nohighlight">\(\kappa\)</span> is either the Planck or Rosseland absorption
coefficients, <span class="math notranslate nohighlight">\(\rho\)</span> is density, <span class="math notranslate nohighlight">\(T\)</span> is temperature, <span class="math notranslate nohighlight">\(\nu\)</span> is
frequency, and <span class="math notranslate nohighlight">\(m\)</span>, <span class="math notranslate nohighlight">\(n\)</span> and <span class="math notranslate nohighlight">\(p\)</span> are constants. For the gray solver,
<span class="math notranslate nohighlight">\(p = 0\)</span>. If <a class="reference internal" href="#equation-eq-kappa">(25)</a> is sufficient, set</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">OPACITY_DIR</span> <span class="o">:=</span> <span class="n">rad_power_law</span>
</pre></div>
</div>
<p>in your GNUmakefile. See § <a class="reference external" href="#sec:opacpars">3.3.1</a> for instructions on how
to configure the parameters used for this opacity setup. If you would prefer a different
opacity mechanism, you will need to create your own opacity module by creating a new
directory in the Microphysics/opacity directory, creating the same set of subroutines
that the others have.</p>
<p>Some notes:</p>
<ul>
<li><p>Here, <span class="math notranslate nohighlight">\(\kappa\)</span> has units of <span class="math notranslate nohighlight">\(\mathrm{cm}^{-1}\)</span>. Some papers or
texts may instead have an implicit density factor in <span class="math notranslate nohighlight">\(\kappa\)</span>,
yielding units <span class="math notranslate nohighlight">\(\mathrm{cm}^2~\mathrm{g}^{-1}\)</span>.</p></li>
<li><p>Castro allows for two temperatures (different radiation and gas
temperature, so <span class="math notranslate nohighlight">\(E_\mathrm{r} \ne a T_\mathrm{gas}^4\)</span>).
Correspondingly, Castro cares about both the Planck mean,
<span class="math notranslate nohighlight">\(\kappa_P\)</span>, and Rosseland mean, <span class="math notranslate nohighlight">\(\kappa_R\)</span>, opacities—these have
different weightings.</p>
<p>If we set <span class="math notranslate nohighlight">\(\kappa_P \Delta x \gg 1\)</span> (<span class="math notranslate nohighlight">\(\kappa_P\)</span> is really large),
then the two temperatures become the same.</p>
<p>If we set <span class="math notranslate nohighlight">\(\kappa_P = \kappa_R\)</span>, then we can see how different the
two temperatures are.</p>
<p>In an optically thick medium, we would not expect the two temperatures
to be very different.</p>
</li>
</ul>
<section id="opacity-parameters">
<span id="sec-opacpars"></span><h4>Opacity Parameters<a class="headerlink" href="#opacity-parameters" title="Link to this heading"></a></h4>
<p>The parameters describing the opacity include:</p>
<ul>
<li><p>For the Planck opacity of the form in <a class="reference internal" href="#equation-eq-kappa">(25)</a>,
the following parameters set the coefficient and exponents.
These are set via the <code class="docutils literal notranslate"><span class="pre">opacity</span></code> namespace in the inputs file.
<code class="docutils literal notranslate"><span class="pre">opacity.const_kappa_p</span></code> must be set positive to be used.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">opacity.const_kappa_p</span> <span class="pre">=</span> <span class="pre">-1.0</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">opacity.kappa_p_exp_m</span> <span class="pre">=</span> <span class="pre">0.0</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">opacity.kappa_p_exp_n</span> <span class="pre">=</span> <span class="pre">0.0</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">opacity.kappa_p_exp_p</span> <span class="pre">=</span> <span class="pre">0.0</span></code></p></li>
</ul>
</li>
<li><p>For the Rosseland opacity of the form in <a class="reference internal" href="#equation-eq-kappa">(25)</a>,
the following parameters set the coefficient and exponents.
These are set via the <code class="docutils literal notranslate"><span class="pre">opacity</span></code> namespace in the inputs file.
<code class="docutils literal notranslate"><span class="pre">opacity.const_kappa_r</span></code> must be set positive to be used.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">opacity.const_kappa_r</span> <span class="pre">=</span> <span class="pre">-1.0</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">opacity.kappa_r_exp_m</span> <span class="pre">=</span> <span class="pre">0.0</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">opacity.kappa_r_exp_n</span> <span class="pre">=</span> <span class="pre">0.0</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">opacity.kappa_r_exp_p</span> <span class="pre">=</span> <span class="pre">0.0</span></code></p></li>
</ul>
</li>
<li><p>For the scattering coefficient of the form in <a class="reference internal" href="#equation-eq-kappa">(25)</a>,
the following parameters set the coefficient and exponents.
These are set via the <code class="docutils literal notranslate"><span class="pre">opacity</span></code> namespace in the inputs file.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">opacity.const_scatter</span> <span class="pre">=</span> <span class="pre">0.0</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">opacity.scatter_exp_m</span> <span class="pre">=</span> <span class="pre">0.0</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">opacity.scatter_exp_n</span> <span class="pre">=</span> <span class="pre">0.0</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">opacity.scatter_exp_p</span> <span class="pre">=</span> <span class="pre">0.0</span></code></p></li>
</ul>
</li>
<li><p>Since the formula above, <a class="reference internal" href="#equation-eq-kappa">(25)</a>, is non-physical and
singular, we must set some floors in practice to prevent
numerical issues. We have one floor for the opacity, which is
applied to both the Planck and Rosseland opacities, and we
also have a temperature floor.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">opacity.kappa_floor</span> <span class="pre">=</span> <span class="pre">1.d-50</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">opacity.rad_temp_floor</span> <span class="pre">=</span> <span class="pre">0.0</span></code></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">radiation.do_kappa_stm_emission</span> <span class="pre">=</span> <span class="pre">0</span></code></p>
<p>If it is 1, correction for stimulated emission is applied to Planck mean as
follows</p>
<div class="math notranslate nohighlight">
\[\kappa = \mathrm{const}\ \rho^{m} T^{-n} \nu^{p}
    \left [1-\exp{\left (-\frac{h\nu}{k T} \right )} \right ].\]</div>
</li>
</ul>
<p>Note that the unit for opacities is <span class="math notranslate nohighlight">\(\mathrm{cm}^{-1}\)</span>. For
the gray solver, the total opacity in the diffusion coefficient is the sum
of kappa_r and scattering, whereas for the MG solver,
there are two possibilities. If const_kappa_r is greater than
0, then the total opacity is set by kappa_r alone, otherwise
the total opacity is the sum of kappa_p and scattering.</p>
</section>
</section>
</section>
<section id="radiation-solver-physics">
<h2>Radiation Solver Physics<a class="headerlink" href="#radiation-solver-physics" title="Link to this heading"></a></h2>
<p>In this section, we list some radiation related parameters that you
can set in an inputs file. Here are some important parameters:</p>
<ul>
<li><p>radiation.SolverType:</p>
<p>Set it to 5 for the gray solver, and 6 for the MG solver.</p>
</li>
<li><p>castro.do_hydro</p>
<p>Usually you want to set it to 1. If it is set to 0,
hydro will be turned off, and the calculation will only solve
radiation diffusion equation.</p>
</li>
<li><p>castro.do_radiation</p>
<p>If it is 0, the calculation will be pure hydro.</p>
</li>
</ul>
<p>Below are more parameters. For each parameter, the default value is
on the right-hand side of the equal sign.</p>
<section id="verbosity-and-i-o">
<span id="sec-bothpar"></span><h3>Verbosity and I/O<a class="headerlink" href="#verbosity-and-i-o" title="Link to this heading"></a></h3>
<ul>
<li><p>radiation.v = 0</p>
<p>Verbosity</p>
</li>
<li><p>radiation.verbose = 0</p>
<p>Verbosity</p>
</li>
<li><p>radiation.plot_lambda = 0</p>
<p>If 1, save flux limiter in plotfiles.</p>
</li>
<li><p>radiation.plot_kappa_p = 0</p>
<p>If 1, save Planck mean opacity in plotfiles.</p>
</li>
<li><p>radiation.plot_kappa_r = 0</p>
<p>If 1, save Rosseland mean opacity in plotfiles.</p>
</li>
<li><p>radiation.plot_lab_Er = 0</p>
<p>If 1, save lab frame radiation energy density in plotfiles.
This flag is ignored when the mixed-frame gray solver is used.</p>
</li>
<li><p>radiation.plot_com_flux = 0</p>
<p>If 1, save comoving frame radiation flux in plotfiles.</p>
</li>
<li><p>radiation.plot_lab_flux = 0</p>
<p>If 1, save lab frame radiation flux in plotfiles.</p>
</li>
</ul>
</section>
<section id="flux-limiter-and-closure">
<span id="sec-fluxlimiter"></span><h3>Flux Limiter and Closure<a class="headerlink" href="#flux-limiter-and-closure" title="Link to this heading"></a></h3>
<ul>
<li><p>radiation.limiter = 2</p>
<p>Possible values are:</p>
<ul class="simple">
<li><p>0: No flux limiter</p></li>
<li><p>2: Approximate limiter of Levermore &amp; Pomraning</p></li>
<li><p>12: Bruenn’s limiter</p></li>
<li><p>22: Larsen’s square root limiter</p></li>
<li><p>32: Minerbo’s limiter</p></li>
</ul>
</li>
<li><p>radiation.closure = 3</p>
<p>Possible values are:</p>
<ul class="simple">
<li><p>0: <span class="math notranslate nohighlight">\(f = \lambda\)</span>, where <span class="math notranslate nohighlight">\(f\)</span> is the scalar Eddington factor
and <span class="math notranslate nohighlight">\(\lambda\)</span> is the flux limiter.</p></li>
<li><p>1: <span class="math notranslate nohighlight">\(f = \frac{1}{3}\)</span></p></li>
<li><p>2: <span class="math notranslate nohighlight">\(f = 1 - 2 \lambda\)</span></p></li>
<li><p>3: <span class="math notranslate nohighlight">\(f = \lambda + (\lambda R)^2\)</span>, where <span class="math notranslate nohighlight">\(R\)</span> is the radiation
Knudsen number.</p></li>
<li><p>4: <span class="math notranslate nohighlight">\(f = \frac{1}{3} + \frac{2}{3} (\frac{F}{cE})^2\)</span>, where
<span class="math notranslate nohighlight">\(F\)</span> is the radiation flux, <span class="math notranslate nohighlight">\(E\)</span> is the radiation energy density,
and <span class="math notranslate nohighlight">\(c\)</span> is the speed of light.</p></li>
</ul>
</li>
</ul>
<p>Note the behavior of the radiative flux in the optically thin and
optically thick limits. The flux limiter, <span class="math notranslate nohighlight">\(\lambda = \lambda(R)\)</span>,
where</p>
<div class="math notranslate nohighlight">
\[R = \frac{|\nabla E_r^{(0)}|}{\chi_R E_r^{(0)}}\]</div>
<p>Regardless of the limiter chosen, when we are optically thick,
<span class="math notranslate nohighlight">\(\chi_R \rightarrow \infty\)</span>, <span class="math notranslate nohighlight">\(R \rightarrow 0\)</span>, and <span class="math notranslate nohighlight">\(\lambda \rightarrow 1/3\)</span>.
The radiative flux then becomes</p>
<div class="math notranslate nohighlight">
\[F_r^{(0)} = -\frac{c\lambda}{\chi_R} \nabla E_r^{(0)} \rightarrow
  \frac{1}{3} \frac{c}{\chi_R} \nabla E_r^{(0)}\]</div>
<p>And when we are optically thin, <span class="math notranslate nohighlight">\(\chi_R \rightarrow 0\)</span>, <span class="math notranslate nohighlight">\(R \rightarrow \infty\)</span>,
and <span class="math notranslate nohighlight">\(\lambda \rightarrow 1/R = \chi_R E_r^{(0)}/{|\nabla E_r^{0}|}\)</span>, and
the radiative flux then becomes</p>
<div class="math notranslate nohighlight">
\[F_r^{(0)} = -\frac{c\lambda}{\chi_R} \nabla E_r^{(0)} \rightarrow
  -\frac{c}{\chi_R}\frac{\chi_R E_r^{(0)}}{|\nabla E_r^{0}|}
    \nabla E_r^{(0)} = -c E_r^{0}\]</div>
<p>See Krumholz et al. 2007 for some discussion on this.</p>
</section>
<section id="boundary-conditions">
<h3>Boundary Conditions<a class="headerlink" href="#boundary-conditions" title="Link to this heading"></a></h3>
<p>The following parameters are for the radiation boundary in the diffusion
equation. They do not affect hydrodynamic boundaries.</p>
<ul>
<li><p>radiation.lo_bc</p>
<p>This sets the action to take at the lower edge of the domain in
each coordinate direction. Possible values are:</p>
<ul>
<li><p>101 <em>Dirichlet</em>:</p>
<p>Specify the radiation energy density on the boundary.
For gray radiation, this could be <span class="math notranslate nohighlight">\(E_r = a T^4\)</span>.</p>
<p>For multigroup radiation, Castro stores the energy density as
<span class="math notranslate nohighlight">\(\mathrm{erg}~\mathrm{cm}^{-3}\)</span>, so the total radiation energy
can be found by simply summing over the groups. So if you want
to set the radiation BCs using the Planck function, you simply
multiply by the group width—see Exec/radiation_tests/RadSphere/Tools/radbc.f90
for an example.</p>
</li>
<li><p>102 <em>Neumann</em>:</p>
<p>Here, you specify the radiation flux on the boundary. For gray
radiation, this is the expression given in the gray Castro paper
(Eq. 7, 8),</p>
<div class="math notranslate nohighlight">
\[F_r = - \frac{c\lambda}{\kappa_R} \nabla E_r\]</div>
<p>where <span class="math notranslate nohighlight">\(\lambda\)</span> is the flux limiter.</p>
<p>Note that if your boundary represents an incoming flux through
a vacuum (like stellar irradiation), then <span class="math notranslate nohighlight">\(\kappa \rightarrow 0\)</span>, leaving</p>
<div class="math notranslate nohighlight">
\[F_r = -c E_r\]</div>
<p>(see § <a class="reference external" href="#sec:fluxlimiter">4.2</a>) in that case.</p>
</li>
<li><p>104 <em>Marshak</em> (vacuum):</p>
<p>Here, you specify the incident flux and the outside is a vacuum.
This differs from the Neumann condition because there is also a
flux coming from inside, for the net flux across the boundary is
different than the incident flux.</p>
</li>
<li><p>105 <em>Sanchez-Pomraning</em>:</p>
<p>This is a modified form of the Marshak boundary condition that works with FLD.
This is like the Marshak condition, but <span class="math notranslate nohighlight">\(\lambda = 1/3\)</span> is not assumed inside
the boundary (optical thickness).</p>
</li>
</ul>
</li>
<li><p>radiation.hi_bc</p>
<p>See radiation.lo_bc.</p>
</li>
<li><p>radiation.lo_bcflag = 0 0 0</p>
<p>If it is 0, bcval is used for that dimension, otherwise
subroutine rbndry in RadBndry_1d.f90 is called to set
boundary conditions.</p>
</li>
<li><p>radiation.hi_bcflag = 0 0 0</p>
<p>See radiation.lo_bcflag</p>
</li>
<li><p>radiation.lo_bcval = 0.0 0.0 0.0</p>
<p>The actual value to impose for the boundary condition type set by
radiation.lo_bc. This parameter is interpreted differently
depending on the boundary condition:</p>
<ul class="simple">
<li><p>Dirchlet: Dirichlet value of rad energy density</p></li>
<li><p>Neumann: inward flux of rad energy</p></li>
<li><p>Marshak: incident flux</p></li>
<li><p>Sanchez-Pomraning: incident flux</p></li>
</ul>
</li>
<li><p>radiation.hi_bcval = 0.0 0.0 0.0</p>
<p>See radiation.lo_bcval</p>
</li>
</ul>
</section>
<section id="convergence">
<h3>Convergence<a class="headerlink" href="#convergence" title="Link to this heading"></a></h3>
<p>For the gray solver, there is only one iteration in the scheme,
whereas for the MG solver, there are two iterations with an inner
iteration embedded inside an outer iteration. In the following, the
iteration in the gray solver will also be referred as the outer
iteration for convenience. The parameters for the inner iteration are
irrelevant to the gray solver.</p>
<dl>
<dt>radiation.maxiter = 50</dt><dd><div class="line-block">
<div class="line"><br /></div>
<div class="line">Maximal number of outer iteration steps.</div>
</div>
</dd>
<dt>radiation.miniter = 1</dt><dd><div class="line-block">
<div class="line"><br /></div>
<div class="line">Minimal number of outer iteration steps.</div>
</div>
</dd>
<dt>radiation.reltol = 1.e-6</dt><dd><div class="line-block">
<div class="line"><br /></div>
<div class="line">Relative tolerance for the outer iteration.</div>
</div>
</dd>
<dt>radiation.abstol = 0.0</dt><dd><div class="line-block">
<div class="line"><br /></div>
<div class="line">Absolute tolerance for the outer iteration.</div>
</div>
</dd>
<dt>radiation.maxInIter = 30</dt><dd><div class="line-block">
<div class="line"><br /></div>
<div class="line">Maximal number of inner iteration steps.</div>
</div>
</dd>
<dt>radiation.minInIter = 1</dt><dd><div class="line-block">
<div class="line"><br /></div>
<div class="line">Minimal number of inner iteration steps.</div>
</div>
</dd>
<dt>radiation.relInTol = 1.e-4</dt><dd><div class="line-block">
<div class="line"><br /></div>
<div class="line">Relative tolerance for the inner iteration.</div>
</div>
</dd>
<dt>radiation.absInTol = 0.0</dt><dd><div class="line-block">
<div class="line"><br /></div>
<div class="line">Absolute tolerance for the inner iteration.</div>
</div>
</dd>
<dt>radiation.convergence_check_type = 0</dt><dd><div class="line-block">
<div class="line"><br /></div>
<div class="line">For the MG solver only. This specify the way of checking the
convergence of an outer iteration. Possible values are</div>
</div>
<ul class="simple">
<li><p>0: Check <span class="math notranslate nohighlight">\(T\)</span>, <span class="math notranslate nohighlight">\(Y_e\)</span>, and the residues of the equations for
<span class="math notranslate nohighlight">\(\rho e\)</span> and <span class="math notranslate nohighlight">\(\rho Y_e\)</span></p></li>
<li><p>1: Check <span class="math notranslate nohighlight">\(\rho e\)</span></p></li>
<li><p>2: Check the residues of the equations for <span class="math notranslate nohighlight">\(\rho e\)</span> and <span class="math notranslate nohighlight">\(\rho Y_e\)</span></p></li>
<li><p>3: Check <span class="math notranslate nohighlight">\(T\)</span> and <span class="math notranslate nohighlight">\(Y_e\)</span></p></li>
</ul>
</dd>
</dl>
</section>
<section id="parameters-for-gray-solver">
<span id="sec-graypar"></span><h3>Parameters for Gray Solver<a class="headerlink" href="#parameters-for-gray-solver" title="Link to this heading"></a></h3>
<dl>
<dt>radiation.comoving = 1</dt><dd><div class="line-block">
<div class="line"><br /></div>
<div class="line">Do we use the comoving frame approach?</div>
</div>
</dd>
<dt>radiation.Er_Lorentz_term = 1</dt><dd><div class="line-block">
<div class="line"><br /></div>
<div class="line">If the mixed-frame approach is taken, this parameter decides whether
Lorentz transformation terms are retained.</div>
</div>
</dd>
<dt>radiation.delta_temp = 1.0</dt><dd><div class="line-block">
<div class="line"><br /></div>
<div class="line">This is used in computing numerical derivativas with respect to <span class="math notranslate nohighlight">\(T\)</span>.
So it should be a small number compared with <span class="math notranslate nohighlight">\(T\)</span>, but not too small.</div>
</div>
</dd>
<dt>radiation.update_limiter = 1000</dt><dd><div class="line-block">
<div class="line"><br /></div>
<div class="line">Stop updating flux limiter after update_limiter iteration steps.</div>
</div>
</dd>
<dt>radiation.update_planck = 1000</dt><dd><div class="line-block">
<div class="line"><br /></div>
<div class="line">Stop updating Planck mean opacity after update_planck iteration steps.</div>
</div>
</dd>
<dt>radiation.update_rosseland = 1000</dt><dd><div class="line-block">
<div class="line"><br /></div>
<div class="line">Stop updating Rosseland mean opacity after update_rosseland iteration steps.</div>
</div>
</dd>
</dl>
</section>
<section id="grouping-in-the-mg-solver">
<h3>Grouping in the MG Solver<a class="headerlink" href="#grouping-in-the-mg-solver" title="Link to this heading"></a></h3>
<p>We provide two methods of setting up groups based upon logarithmic
spacing. In both methods, you must provide:</p>
<dl>
<dt>radiation.nGroups</dt><dd><div class="line-block">
<div class="line"><br /></div>
<div class="line">Number of groups.</div>
</div>
</dd>
<dt>radiation.lowestGroupHz</dt><dd><div class="line-block">
<div class="line"><br /></div>
<div class="line">Frequency of the lower bound for the first group.</div>
</div>
</dd>
</dl>
<p>In addition, if the parameter groupGrowFactor is provided, then
the first method will be used, otherwise the second method will be
used. In the first way, you must also provide firstGroupWidthHz
(the width of the first group). The width of other groups is set to
be groupGrowFactor times the width of its immediately preceding
group. In the second way, you must provide highestGroupHz as
the upper bound of the last group. It should be noted that
lowestGroupHz can be 0 in the first method, but not the second
method. However, when we compute the group-integrated Planck
function, the lower bound for the first group and the upper bound for
the last group are assumed to be 0 and <span class="math notranslate nohighlight">\(\infty\)</span>, respectively.</p>
</section>
<section id="parameters-for-mg-solver">
<span id="sec-mgpar"></span><h3>Parameters for MG Solver<a class="headerlink" href="#parameters-for-mg-solver" title="Link to this heading"></a></h3>
<dl>
<dt>radiation.delta_e_rat_dt_tol = 100.0</dt><dd><div class="line-block">
<div class="line"><br /></div>
<div class="line">Maximally allowed relative change in <span class="math notranslate nohighlight">\(e\)</span> during one time step.</div>
</div>
</dd>
<dt>radiation.delta_T_rat_dt_tol = 100.0</dt><dd><div class="line-block">
<div class="line"><br /></div>
<div class="line">Maximally allowed relative change in <span class="math notranslate nohighlight">\(T\)</span> during one time step.</div>
</div>
</dd>
<dt>radiation.delta_Ye_dt_tol = 100.0</dt><dd><div class="line-block">
<div class="line"><br /></div>
<div class="line">Maximally allowed absolute change in <span class="math notranslate nohighlight">\(Y_e\)</span> during one tim estep.</div>
</div>
</dd>
<dt>radiation.fspace_advection_type = 2</dt><dd><div class="line-block">
<div class="line"><br /></div>
<div class="line">Possible value is 1 or 2. The latter is better.</div>
</div>
</dd>
<dt>radiation.integrate_Planck = 1</dt><dd><div class="line-block">
<div class="line"><br /></div>
<div class="line">If 1, integrate Planck function for each group. For the first
group, the lower bound in the integration is assumed to be 0 no
matter what the grouping is. For the last group, the upper bound in
the integration is assumed to be <span class="math notranslate nohighlight">\(\infty\)</span>.</div>
</div>
</dd>
<dt>radiation.matter_update_type = 0</dt><dd><div class="line-block">
<div class="line"><br /></div>
<div class="line">How to update matter. 0 is proabaly the best.</div>
</div>
</dd>
<dt>radiation.accelerate = 2</dt><dd><div class="line-block">
<div class="line"><br /></div>
<div class="line">The inner iteration of the MG solver usually requires an
acceleration scheme. Choices are</div>
</div>
<ul class="simple">
<li><p>0: No acceleration</p></li>
<li><p>1: Local acceleration</p></li>
<li><p>2: Gray acceleration</p></li>
</ul>
</dd>
<dt>radiation.skipAccelAllowed = 0</dt><dd><div class="line-block">
<div class="line"><br /></div>
<div class="line">If it is set to 1, skip acceleration if it does not help.</div>
</div>
</dd>
<dt>radiation.n_bisect = 1000</dt><dd><div class="line-block">
<div class="line"><br /></div>
<div class="line">Do bisection for the outer iteration after n_bisec iteration steps.</div>
</div>
</dd>
<dt>radiation.use_dkdT = 1</dt><dd><div class="line-block">
<div class="line"><br /></div>
<div class="line">If it is 1, <span class="math notranslate nohighlight">\(\frac{\partial \kappa}{\partial T}\)</span> is retained in the
Jacobi matrix for the outer (Newton) iteration.</div>
</div>
</dd>
<dt>radiation.update_opacity = 1000</dt><dd><div class="line-block">
<div class="line"><br /></div>
<div class="line">Stop updating opacities after update_opacity outer iteration steps.</div>
</div>
</dd>
<dt>radiation.inner_update_limiter = 0</dt><dd><div class="line-block">
<div class="line"><br /></div>
<div class="line">Stop updating flux limiter after inner_update_limiter inner
iteration steps. If it is 0, the limiter is lagged by one outer
iteration. If it is -1, the limiter is lagged by one time step. If
the inner iteration has difficulty in converging, setting this
parameter it to -1 can help. Since the flux limiter is only a
kludge, it is justified to lag it.</div>
</div>
</dd>
</dl>
</section>
<section id="linear-system-solver">
<span id="sec-hypre"></span><h3>Linear System Solver<a class="headerlink" href="#linear-system-solver" title="Link to this heading"></a></h3>
<p>There are a number of choices for the linear system solver. The
performance of the solvers usually depends on problems and the
computer. So it is worth trying a few solvers to find out which one
is best for your problem and computer.</p>
<p>radsolve.level_solver_flag: the linear solver
in Hypre to use. The available choices are:</p>
<ul class="simple">
<li><p>0: SMG</p></li>
<li><p>1: PFMG (<span class="math notranslate nohighlight">\(\ge\)</span> 2-d only)</p></li>
<li><p>100: AMG using ParCSR ObjectType</p></li>
<li><p>102: GMRES using ParCSR ObjectType</p></li>
<li><p>103: GMRES using SStruct ObjectType</p></li>
<li><p>104: GMRES using AMG as preconditioner</p></li>
<li><p>109: GMRES using Struct SMG/PFMG as preconditioner</p></li>
<li><p>150: AMG using ParCSR ObjectType</p></li>
<li><p>1002: PCG using ParCSR ObjectType</p></li>
<li><p>1003: PCG using SStruct ObjectType</p></li>
</ul>
<p>As a general rule, the SMG is the most stable solver, but is usually
the slowest. The asymmetry in the linear system comes from the
adaptive mesh, so the PFMG should be your first choice. Note: in
you cannot use PFMG.</p>
<p>Setting this to 109 (GMRES using Struct SMG/PFMG as preconditioner)
should work reasonably well for most problems.</p>
<p>radsolve.maxiter (default: 40):
Maximal number of iteration in Hypre.</p>
<p>radsolve.reltol (default: 1.e-10):
Relative tolerance in Hypre</p>
<p>radsolve.abstol (default: 0):
Absolute tolerance in Hypre</p>
<p>radsolve.v (default: 0):
Verbosity</p>
<p>radsolve.verbos (default: 0):
Verbosity</p>
<p>habec.verbose (default: 0):
Verbosity for level_solver_flag <span class="math notranslate nohighlight">\(&lt;\)</span> 100</p>
<p>hmabec.verbose (default: 0):
Verbosity for level_solver_flag <span class="math notranslate nohighlight">\(&gt;=\)</span> 100</p>
</section>
</section>
<section id="output">
<h2>Output<a class="headerlink" href="#output" title="Link to this heading"></a></h2>
<section id="gray-solver">
<h3>Gray Solver<a class="headerlink" href="#gray-solver" title="Link to this heading"></a></h3>
<p>For the gray radiation solver, the radiation energy density is stored in plotfiles
as rad. Note that this quantity has units of <span class="math notranslate nohighlight">\(\mathrm{erg~cm^{-3}}\)</span>, which
is different that the specify internal energy of the gas <span class="math notranslate nohighlight">\(\mathrm{erg~g^{-1}}\)</span>.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="sponge.html" class="btn btn-neutral float-left" title="Sponge" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Particles.html" class="btn btn-neutral float-right" title="Tracer particles" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018-2024, Castro development team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  


</body>
</html>