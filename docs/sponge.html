

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Sponge &mdash; Castro  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"TeX": {"Macros": {"kth": "{{k_\\mathrm{th}}}", "gcc": "{\\mathrm{g~cm^{-3}}}", "cms": "{\\mathrm{cm~s^{-1}}}", "presunit": "{\\mathrm{dyn~cm^{-2}}}", "accelunit": "{\\mathrm{cm~s^{-2}}}", "ergg": "{\\mathrm{erg~g^{-1}}}", "Ab": "{{\\bf A}}", "eb": "{{\\bf e}}", "Fb": "{{\\bf F}}", "gb": "{{\\bf g}}", "Hb": "{{\\bf H}}", "ib": "{{\\bf i}}", "Ib": "{{\\bf I}}", "Kb": "{{\\bf K}}", "lb": "{{\\bf l}}", "Lb": "{{\\bf L}}", "nb": "{{\\bf n}}", "Pb": "{{\\bf P}}", "Qb": "{{\\bf Q}}", "rb": "{{\\bf r}}", "Rb": "{{\\bf R}}", "Sb": "{{\\bf S}}", "ub": "{{\\bf u}}", "Ub": "{{\\bf U}}", "xb": "{{\\bf x}}", "dt": "{\\Delta t}", "omegadot": "{\\dot\\omega}", "inp": "{{\\rm in}}", "outp": "{{\\rm out}}", "sync": "{{\\rm sync}}", "half": "{\\frac{1}{2}}", "myhalf": "{\\half}", "nph": "{{n+\\myhalf}}", "kpp": "{\\ensuremath{\\kappa_{\\mathrm{P}}}}", "kpr": "{\\ensuremath{\\kappa_{\\mathrm{R}}}}", "kpf": "{\\ensuremath{\\kappa_{\\mathrm{F}}}}", "vb": "{\\boldsymbol{v}}", "vbt": "{\\widetilde{\\vb}}", "rbt": "{\\widetilde{\\rb}}", "ob": "{\\boldsymbol{\\omega}}", "nablab": "{\\boldsymbol{\\nabla}}", "avg": ["{{\\left \\langle #1 \\right \\rangle}}", 1]}}})</script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Radiation" href="radiation.html" />
    <link rel="prev" title="Rotation" href="rotation.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          


          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> Castro
          

          
            
            <img src="_static/castro_logo_hot_200.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
    <div class="branch">
        Branch: <a href="./sponge.html">main</a> | <a href="./dev/sponge.html">development</a>
    </div>

        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Castro basics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Preface.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="Introduction.html">Introduction to Castro</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="inputs.html">Input Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="rp_intro.html">Runtime Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="mpi_plus_x.html">Running Options: CPUs and GPUs</a></li>
<li class="toctree-l1"><a class="reference internal" href="FlowChart.html">Flowchart</a></li>
<li class="toctree-l1"><a class="reference internal" href="software.html">Software Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="problem_setups.html">Distributed Problem Setups</a></li>
<li class="toctree-l1"><a class="reference internal" href="timestepping.html">Timestepping and Retries</a></li>
<li class="toctree-l1"><a class="reference internal" href="creating_a_problem.html">Setting Up Your Own Problem</a></li>
<li class="toctree-l1"><a class="reference internal" href="io.html">Outputting</a></li>
<li class="toctree-l1"><a class="reference internal" href="regridding.html">Regridding</a></li>
<li class="toctree-l1"><a class="reference internal" href="visualization.html">Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption"><span class="caption-text">Castro reference</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="build_system.html">Build System Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="gpu_porting.html">Offloading a routine to GPU</a></li>
<li class="toctree-l1"><a class="reference internal" href="Hydrodynamics.html">Hydrodynamics</a></li>
<li class="toctree-l1"><a class="reference internal" href="mhd.html">MHD</a></li>
<li class="toctree-l1"><a class="reference internal" href="gravity.html">Gravity</a></li>
<li class="toctree-l1"><a class="reference internal" href="diffusion.html">Diffusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="rotation.html">Rotation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Sponge</a></li>
<li class="toctree-l1"><a class="reference internal" href="radiation.html">Radiation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Particles.html">Tracer particles</a></li>
<li class="toctree-l1"><a class="reference internal" href="EOSNetwork.html">Microphysics</a></li>
<li class="toctree-l1"><a class="reference internal" href="sdc.html">Spectral Deferred Corrections</a></li>
<li class="toctree-l1"><a class="reference internal" href="AMR.html">Adaptive Mesh Refinement</a></li>
<li class="toctree-l1"><a class="reference internal" href="ConvertCheckpoint.html">Checkpoint Embiggener</a></li>
<li class="toctree-l1"><a class="reference internal" href="self_consistent_field.html">Self-Consistent Field Initialization</a></li>
<li class="toctree-l1"><a class="reference internal" href="MAESTRO_restart.html">Restarting from Maestro</a></li>
<li class="toctree-l1"><a class="reference internal" href="Verification.html">Verification</a></li>
<li class="toctree-l1"><a class="reference internal" href="development.html">Development Best Practices</a></li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="filelist.html">File list</a></li>
<li class="toctree-l1"><a class="reference internal" href="classlist.html">Class list</a></li>
</ul>
<p class="caption"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="zreferences.html">References</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Castro</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Sponge</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/sponge.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="sponge">
<span id="sponge-section"></span><h1>Sponge<a class="headerlink" href="#sponge" title="Permalink to this headline">Â¶</a></h1>
<p>Castro uses a sponge source term to damp velocities in regions where
we are not interested in the dynamics, to prevent them from
dominating the timestep constraint.  Often these are buffer regions
between the domain of interest and the boundary conditions.</p>
<p>The sponge parameters are set in your <code class="docutils literal notranslate"><span class="pre">probin</span></code> file, in the
<code class="docutils literal notranslate"><span class="pre">&amp;sponge</span></code> namelist.  The timescale of the damping is set through
<code class="docutils literal notranslate"><span class="pre">sponge_timescale</span></code>.</p>
<p>The sponge value, <span class="math notranslate nohighlight">\(f_\mathrm{sponge}\)</span> is computed as described below
and then the sponge factor, <span class="math notranslate nohighlight">\(f\)</span> is computed as:</p>
<div class="math notranslate nohighlight">
\[f = - \left [ 1 - \frac{1}{1 + \alpha f_\mathrm{sponge}}\right ]\]</div>
<p>for an implicit update or</p>
<div class="math notranslate nohighlight">
\[f = -\alpha f_\mathrm{sponge}\]</div>
<p id="index-0">for an explicit update.  This choice is controlled by
<code class="docutils literal notranslate"><span class="pre">sponge_implicit</span></code>.  Here, <span class="math notranslate nohighlight">\(\alpha\)</span> is constructed from the
<code class="docutils literal notranslate"><span class="pre">sponge_timescale</span></code> parameter, <span class="math notranslate nohighlight">\(t_\mathrm{sponge}\)</span> as:</p>
<div class="math notranslate nohighlight">
\[\alpha = \frac{\Delta t}{t_\mathrm{sponge}}\]</div>
<p>The sponge source is then added to the momentum and total energy equations.</p>
<p>The general sponge parameters are:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 52%" />
<col style="width: 48%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>variable</p></th>
<th class="head"><p>runtime parameter</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(f_\mathrm{lower}\)</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">sponge_lower_factor</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(f_\mathrm{upper}\)</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">sponge_upper_factor</span></code></p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>There are three sponges, each controlled by different runtime parameters:</p>
<blockquote>
<div><ul>
<li><p><strong>radial sponge</strong> : The radial sponge operates beyond some radius
(define in terms of the <code class="docutils literal notranslate"><span class="pre">center(:)</span></code> position for the problem).
It takes the form:</p>
<div class="math notranslate nohighlight">
\[\begin{split}f_\mathrm{sponge} = \left \{
      \begin{array}{cc}
              f_\mathrm{lower}   &amp; r &lt; r_\mathrm{lower} \\
              f_\mathrm{lower} + \frac{f_\mathrm{upper} - f_\mathrm{lower}}{2}
                   \left [ 1 - \cos \left ( \frac{\pi (r - r_\mathrm{lower})}{\Delta r} \right ) \right ]  &amp; r_\mathrm{lower} \le r &lt; r_\mathrm{upper} \\
              f_\mathrm{upper} &amp; r \ge r_\mathrm{upper}
      \end{array} \right .\end{split}\]</div>
<p>The parameters controlling the various quantities here are:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 52%" />
<col style="width: 48%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>variable</p></th>
<th class="head"><p>runtime parameter</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(r_\mathrm{lower}\)</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">sponge_lower_radius</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(r_\mathrm{upper}\)</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">sponge_upper_radius</span></code></p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>and <span class="math notranslate nohighlight">\(\Delta r = r_\mathrm{upper} - r_\mathrm{lower}\)</span> .</p>
</li>
<li><p><strong>density sponge</strong> : The density sponge turns on based on density
thresholds.  At high densities, we usually care about the
dynamics, so we will want the sponge off, but as the density
lowers, we gradually turn on the sponge.  It takes the form:</p>
<div class="math notranslate nohighlight">
\[\begin{split}f_\mathrm{sponge} = \left \{
      \begin{array}{cc}
              f_\mathrm{lower}   &amp; \rho &gt; \rho_\mathrm{upper} \\
              f_\mathrm{lower} + \frac{f_\mathrm{upper} - f_\mathrm{lower}}{2}
                   \left [ 1 - \cos \left ( \frac{\pi (\rho - \rho_\mathrm{upper})}{\Delta \rho} \right ) \right ]  &amp; \rho_\mathrm{upper} \ge \rho &gt; \rho_\mathrm{lower} \\
              f_\mathrm{upper} &amp; \rho &lt; \rho_\mathrm{lower}
      \end{array} \right .\end{split}\]</div>
<p>The parameters controlling the various quantities here are:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 52%" />
<col style="width: 48%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>variable</p></th>
<th class="head"><p>runtime parameter</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\rho_\mathrm{lower}\)</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">sponge_lower_density</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\rho_\mathrm{upper}\)</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">sponge_upper_density</span></code></p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>and <span class="math notranslate nohighlight">\(\Delta \rho = \rho_\mathrm{upper} - \rho_\mathrm{lower}\)</span> .</p>
</li>
<li><p><strong>pressure sponge</strong> : The pressure sponge is just like the density sponge,
except it is keyed on pressure.  It takes the form:</p>
<div class="math notranslate nohighlight">
\[\begin{split}f_\mathrm{sponge} = \left \{
      \begin{array}{cc}
              f_\mathrm{lower}   &amp; p &gt; p_\mathrm{upper} \\
              f_\mathrm{lower} + \frac{f_\mathrm{upper} - f_\mathrm{lower}}{2}
                   \left [ 1 - \cos \left ( \frac{\pi (p - p_\mathrm{upper})}{\Delta p} \right ) \right ]  &amp; p_\mathrm{upper} \ge p \ge p_\mathrm{lower} \\
              f_\mathrm{upper} &amp; \rho &lt; \rho_\mathrm{lower}
      \end{array} \right .\end{split}\]</div>
<p>The parameters controlling the various quantities here are:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 52%" />
<col style="width: 48%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>variable</p></th>
<th class="head"><p>runtime parameter</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(p_\mathrm{lower}\)</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">sponge_lower_pressure</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(p_\mathrm{upper}\)</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">sponge_upper_pressure</span></code></p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>and <span class="math notranslate nohighlight">\(\Delta p = p_\mathrm{upper} - p_\mathrm{lower}\)</span> .</p>
</li>
</ul>
</div></blockquote>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="radiation.html" class="btn btn-neutral float-right" title="Radiation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="rotation.html" class="btn btn-neutral float-left" title="Rotation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2018-2020, Castro development tem

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    


</body>
</html>