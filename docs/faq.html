<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Frequently Asked Questions &mdash; Castro  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="_static/theme_overrides.css?v=2e394b92" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=5929fcd5"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Build System Overview" href="build_system.html" />
    <link rel="prev" title="Visualization" href="visualization.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >


          
          
          <a href="index.html" class="icon icon-home">
            Castro
              <img src="_static/castro_logo_hot_200.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
    <div class="branch">
        Branch: <a href="./faq.html">main</a> | <a href="./dev/faq.html">development</a>
    </div>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Castro basics</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Preface.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="Introduction.html">Introduction to Castro</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="inputs.html">Input Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="rp_intro.html">Runtime Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="mpi_plus_x.html">Running Options: CPUs and GPUs</a></li>
<li class="toctree-l1"><a class="reference internal" href="FlowChart.html">Flowchart</a></li>
<li class="toctree-l1"><a class="reference internal" href="software.html">Software Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="problem_setups.html">Distributed Problem Setups</a></li>
<li class="toctree-l1"><a class="reference internal" href="timestepping.html">Timestepping and Retries</a></li>
<li class="toctree-l1"><a class="reference internal" href="creating_a_problem.html">Setting Up Your Own Problem</a></li>
<li class="toctree-l1"><a class="reference internal" href="io.html">Outputting</a></li>
<li class="toctree-l1"><a class="reference internal" href="regridding.html">Regridding</a></li>
<li class="toctree-l1"><a class="reference internal" href="visualization.html">Visualization</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Frequently Asked Questions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#compiling">Compiling</a></li>
<li class="toctree-l2"><a class="reference internal" href="#debugging">Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="#profiling">Profiling</a></li>
<li class="toctree-l2"><a class="reference internal" href="#managing-runs">Managing Runs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#runtime-errors">Runtime Errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="#visualization">Visualization</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Castro reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="build_system.html">Build System Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="Hydrodynamics.html">Hydrodynamics</a></li>
<li class="toctree-l1"><a class="reference internal" href="hse.html">Hydrostatic Equilibrium</a></li>
<li class="toctree-l1"><a class="reference internal" href="EOS.html">Equation of State</a></li>
<li class="toctree-l1"><a class="reference internal" href="reactions.html">Reactions</a></li>
<li class="toctree-l1"><a class="reference internal" href="mhd.html">MHD</a></li>
<li class="toctree-l1"><a class="reference internal" href="gravity.html">Gravity</a></li>
<li class="toctree-l1"><a class="reference internal" href="diffusion.html">Thermal Diffusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="rotation.html">Rotation</a></li>
<li class="toctree-l1"><a class="reference internal" href="sponge.html">Sponge</a></li>
<li class="toctree-l1"><a class="reference internal" href="radiation.html">Radiation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Particles.html">Tracer particles</a></li>
<li class="toctree-l1"><a class="reference internal" href="sdc.html">Spectral Deferred Corrections</a></li>
<li class="toctree-l1"><a class="reference internal" href="AMR.html">Adaptive Mesh Refinement</a></li>
<li class="toctree-l1"><a class="reference internal" href="ConvertCheckpoint.html">Checkpoint Embiggener</a></li>
<li class="toctree-l1"><a class="reference internal" href="self_consistent_field.html">Self-Consistent Field Initialization</a></li>
<li class="toctree-l1"><a class="reference internal" href="MAESTRO_restart.html">Restarting from Maestro</a></li>
<li class="toctree-l1"><a class="reference internal" href="Verification.html">Verification</a></li>
<li class="toctree-l1"><a class="reference internal" href="development.html">Development Best Practices</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="filelist.html">File list</a></li>
<li class="toctree-l1"><a class="reference internal" href="classlist.html">Class list</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="zreferences.html">References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Castro</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Frequently Asked Questions</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/faq.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="frequently-asked-questions">
<h1>Frequently Asked Questions<a class="headerlink" href="#frequently-asked-questions" title="Link to this heading"></a></h1>
<section id="compiling">
<h2>Compiling<a class="headerlink" href="#compiling" title="Link to this heading"></a></h2>
<ol class="arabic">
<li><p><em>Compiling fails giving me a cryptic message about a module not
being found.</em></p>
<p>This usually indicates that the build system cannot find a source file.
The source files are specified
in the various <code class="docutils literal notranslate"><span class="pre">Make.package</span></code> files throughout the
Castro directory hierarchy. make will look through the
directories in the <code class="docutils literal notranslate"><span class="pre">VPATH_LOCATIONS</span></code> to find the files.</p>
<p>There are 2 things you can do to check what’s happening. First, inspect
the directories in <code class="docutils literal notranslate"><span class="pre">VPATH_LOCATIONS</span></code>. This can be done via:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="nb">print</span><span class="o">-</span><span class="n">VPATH_LOCATIONS</span>
</pre></div>
</div>
<p>Next, ask make to tell you where it is finding each of the source
files. This is done through a script <code class="docutils literal notranslate"><span class="pre">find_files_vpath.py</span></code>
that is hooked into Castro’s build system. You can run this as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">file_locations</span>
</pre></div>
</div>
<p>At the end of the report, it will list any files it cannot find in
the vpath. Some of these are to be expected (like <code class="docutils literal notranslate"><span class="pre">extern.f90</span></code>
and <code class="docutils literal notranslate"><span class="pre">buildInfo.cpp</span></code>—these are written at compile-time. But any
other missing files need to be investigated.</p>
</li>
<li><p><em>I’m still having trouble compiling. How can I find out what
all of the make variables are set to?</em></p>
<p>Use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">help</span>
</pre></div>
</div>
<p>This will tell you the value of all the compilers and their options.</p>
</li>
</ol>
</section>
<section id="debugging">
<span id="debugging-backtrace"></span><h2>Debugging<a class="headerlink" href="#debugging" title="Link to this heading"></a></h2>
<ol class="arabic">
<li><p><em>Castro crashes with a floating point exception—how can
I get more information?</em></p>
<p>The best thing to do is to recompile the code with <code class="docutils literal notranslate"><span class="pre">TEST=TRUE</span></code>
set in the <code class="docutils literal notranslate"><span class="pre">GNUmakefile</span></code>. This will have AMReX catch the
signals raised in C++ functions. Behind the
scenes, this defines the <code class="docutils literal notranslate"><span class="pre">AMREX_TESTING</span></code> preprocessor flag, which
will initialize memory allocated in fabs or multifabs to
signaling NaNs (sNaN), and use the <code class="docutils literal notranslate"><span class="pre">BLBackTrace::handler()</span></code>
function to handle various signals raised in C++
functions. This is a Linux/UNIX capability. This gives us a chance
to print out backtrace information. The signals include seg fault,
floating point exceptions (NaNs, divided by zero and overflow), and
interruption by the user and system. What signals are handed to
AMReX are controlled by AMReX(e.g., using interruption by the
user, this was once used to find an MPI deadlock.) It also includes
the <code class="docutils literal notranslate"><span class="pre">AMREX_ASSERTION</span></code> statements if <code class="docutils literal notranslate"><span class="pre">USE_ASSERTION=TRUE</span></code> or
<code class="docutils literal notranslate"><span class="pre">DEBUG=TRUE</span></code>.</p>
<p>The AMReX parameters that affect the behavior are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">amrex.fpe_trap_invalid</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">amrex.fpe_trap_zero</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">amrex.fpe_trap_overflow</span></code></p></li>
</ul>
<p>For further capabilities, you can get
more information than the backtrace of the call stack info by
instrumenting the code.  Here is an
example. You know the line <code class="docutils literal notranslate"><span class="pre">Real</span> <span class="pre">rho</span> <span class="pre">=</span> <span class="pre">state(cell,0);</span></code> is
causing a segfault. You could add a print statement before that.
But it might print out thousands (or even millions) of line before
it hits the segfault. Instead, you could</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">ostringstream</span><span class="w"> </span><span class="n">ss</span><span class="p">;</span>
<span class="n">ss</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;state.box() = &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="n">box</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; cell = &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">cell</span><span class="p">;</span>
<span class="n">BL_BACKTRACE_PUSH</span><span class="p">(</span><span class="n">ss</span><span class="p">.</span><span class="n">str</span><span class="p">());</span><span class="w"> </span><span class="c1">// PUSH takes std::string</span>

<span class="n">Real</span><span class="w"> </span><span class="n">rho</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="w">  </span><span class="c1">// state is a Fab, and cell is an IntVect.</span>
</pre></div>
</div>
<p>The “print” prints to a stack of string, not stdout. When it hits
the segfault, you will only see the last print out in the backtrace
file (e.g. <code class="docutils literal notranslate"><span class="pre">BackTrace.0</span></code>).</p>
<p>You may need to include the header <code class="docutils literal notranslate"><span class="pre">AMReX_BLBackTrace.H</span></code>.</p>
</li>
<li><p><em>How can I monitor the state in a zone from the C side
at various points in the evolution?</em></p>
<p>Given a MultiFab <code class="docutils literal notranslate"><span class="pre">mf</span></code>, you can dump out the state as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">print_state</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">IntVect</span><span class="p">(</span><span class="n">AMREX_D_DECL</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">)));</span>
</pre></div>
</div>
<p>Here, the IntVect has the dimension that we were compiled with
(and this is handled through the preprocessor <code class="docutils literal notranslate"><span class="pre">AMREX_D_DECL</span></code>). In
this case, we are inspecting zone (10, 20, 30), in the global index
space. Note that since a multifab exists only on a single level, the
integer indices here refer to the global index space on that level.</p>
</li>
<li><p><em>What if I want to see all the data in a FArrayBox?</em></p>
<p>You can simply output a FAB to <code class="docutils literal notranslate"><span class="pre">std::cout</span></code>. Imagine that you
are in an MFIter loop, with a MultiFab <code class="docutils literal notranslate"><span class="pre">mf</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">S</span> <span class="o">=</span> <span class="n">FArrayBox</span><span class="o">&amp;</span> <span class="n">mf</span><span class="p">[</span><span class="n">mfi</span><span class="p">];</span>
<span class="n">std</span><span class="p">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">S</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="p">::</span><span class="n">endl</span><span class="p">;</span>
</pre></div>
</div>
<p>This will output the contents on the FAB, one zone per line.</p>
</li>
</ol>
</section>
<section id="profiling">
<h2>Profiling<a class="headerlink" href="#profiling" title="Link to this heading"></a></h2>
<ol class="arabic">
<li><p><em>How can I get line-by-line profiling information?</em></p>
<p>With the GNU compilers, you can enabling profiling with gprof
by compiling with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">USE_GPROF</span><span class="o">=</span><span class="n">TRUE</span>
</pre></div>
</div>
<p>in your <code class="docutils literal notranslate"><span class="pre">GNUmakefile</span></code>.</p>
<p>When you run, a file named <code class="docutils literal notranslate"><span class="pre">gmon.out</span></code> will be produced. This can
be processed with gprof by running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gprof</span> <span class="n">exec</span><span class="o">-</span><span class="n">name</span>
</pre></div>
</div>
<p>where <em>exec-name</em> is the name of the executable. More detailed
line-by-line information can be obtained by passing the -l
argument to gprof.</p>
</li>
</ol>
</section>
<section id="managing-runs">
<h2>Managing Runs<a class="headerlink" href="#managing-runs" title="Link to this heading"></a></h2>
<ol class="arabic">
<li><p><em>How can I force the running code to output, even it the plot or
checkpoint interval parameters don’t require it?</em></p>
<p>Create a file called <code class="docutils literal notranslate"><span class="pre">dump_and_continue</span></code>, e.g., as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">touch</span> <span class="n">dump_and_continue</span>
</pre></div>
</div>
<p>This will force the code to output a checkpoint file that can be used
to restart. Other options are <code class="docutils literal notranslate"><span class="pre">plot_and_continue</span></code> to output
a plotfile, <code class="docutils literal notranslate"><span class="pre">dump_and_stop</span></code> to output a checkpoint file
and halt the code, and <code class="docutils literal notranslate"><span class="pre">stop_run</span></code> to simply stop the code.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The parameter <code class="docutils literal notranslate"><span class="pre">amr.message_int</span></code> controls how often the
existence of these files is checked; by default it is 1, so the
check will be done at the end of every timestep, but you can
set it to some other integer to check only timesteps that are a
multiple of that number.</p>
</div>
</li>
<li><p><em>How can I output plotfiles in single precision?</em></p>
<p>The AMReX runtime parameter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fab</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="n">NATIVE_32</span>
</pre></div>
</div>
<p>controls this (put this in your inputs file). Note: checkpoint files are unaffected
by this and will always be written out in the native precision (the ‘fab.format‘ parameter
is overridden in the checkpoint code in AMReX).</p>
</li>
<li><p><em>How can I check the compilation parameters of a Castro executable?</em></p>
<p>The build information (including git hashes, modules, EoS, network, etc.) can be displayed by running the executable as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">Castro</span><span class="o">.</span><span class="n">exe</span> <span class="o">--</span><span class="n">describe</span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="runtime-errors">
<span id="ch-faq-vis"></span><h2>Runtime Errors<a class="headerlink" href="#runtime-errors" title="Link to this heading"></a></h2>
<ol class="arabic" id="index-0">
<li><p><em>When running with retries, Castro requests too many substeps
and crashes.</em></p>
<p>This can occur due to CFL violations or negative densities.  If
there are density resets, try running with
<code class="docutils literal notranslate"><span class="pre">castro.limit_fluxes_on_small_dens</span> <span class="pre">=</span> <span class="pre">1</span></code>.  This will use a flux
limiter to prevent the density from going negative.</p>
</li>
<li><p><em>There might be a problem when Castro tries to normalize mass fractions
and encounters: ``Invalid mass fraction in Castro::normalize_species()``.</em></p>
<p>If the error happens at the beginning of the timestep, it is possible that
something unexpected happened durng the interpolation from the coarse-level
to the fine-level. Try to set <code class="docutils literal notranslate"><span class="pre">castro.state_interp_order</span> <span class="pre">=</span> <span class="pre">0</span></code> in the
input file. This allows piecewise constant refinement, but sacrifices
some benefit of the refinement.</p>
<p>If the error continues, try to increase the tolerance of determining
specie abundance validity check by setting <code class="docutils literal notranslate"><span class="pre">castro.abundance_failure_tolerance</span></code>
to a higher value, or increasing the density floor below which this is
ignored by changing <code class="docutils literal notranslate"><span class="pre">castro.abundance_failure_rho_cutoff</span></code>.</p>
</li>
</ol>
</section>
<section id="visualization">
<h2>Visualization<a class="headerlink" href="#visualization" title="Link to this heading"></a></h2>
<ol class="arabic">
<li><p><em>When I try to use Amrvis with the Nvidia driver, all I see is
black—no data. How do I fix this?</em></p>
<p>You need to edit your xorg.conf file (usually found in /etc/X11/
to enable the Dac8Bit option. The section will look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Section</span> <span class="s2">&quot;Device&quot;</span>
    <span class="n">Identifier</span>     <span class="s2">&quot;Device0&quot;</span>
    <span class="n">Driver</span>         <span class="s2">&quot;nvidia&quot;</span>
    <span class="n">VendorName</span>     <span class="s2">&quot;NVIDIA Corporation&quot;</span>
    <span class="n">Option</span>         <span class="s2">&quot;Dac8bit&quot;</span> <span class="s2">&quot;True&quot;</span>
<span class="n">EndSection</span>
</pre></div>
</div>
<p>If you don’t already have an <code class="docutils literal notranslate"><span class="pre">xorg.conf</span></code> then you can create one
by running <code class="docutils literal notranslate"><span class="pre">nvidia-xconfig</span></code> first.</p>
</li>
</ol>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="visualization.html" class="btn btn-neutral float-left" title="Visualization" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="build_system.html" class="btn btn-neutral float-right" title="Build System Overview" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018-2022, Castro development team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  


</body>
</html>